- job:
    name: monasca-notification
    project-type: freestyle
    description: Build the Monasca Notification engine
    scm:
        - git:
            url: https://github.com/stackforge/monasca-notification
            name: origin
            skip-tag: true
            prune: true
            clean:
                before: true
            wipe-workspace: true
    builders:
        - shell: apt-get install -y python-mysqldb
        - shell: pip install -r requirements.txt
        - shell: pip install -r test-requirements.txt
        - shell: "nosetests --with-xunit --with-xcoverage --cover-package=monasca_notification --cover-inclusive"
        - shell: "pep8 ./ | tee pep8.txt"
        - shell: python ./setup.py bdist_wheel
    publishers:
        - junit:
            results: nosetests.xml
        - violations:
            pep8:
              min: 0
              max: 1
              unstable: 1
              pattern: '**/pep8.txt'
        - archive:
            artifacts: 'dist/*.whl'
